= Template Management

Preconfigured Red Hat virtual machine templates are listed in the *Virtualization* -> *Templates* page. These templates are available for different versions of Red Hat Enterprise Linux, Fedora, Microsoft Windows 10, and Microsoft Windows Server. Each Red Hat virtual machine template is preconfigured with the operating system image, default settings for the operating system, flavor (CPU and memory), and workload type (server).

The *Templates* page displays four types of virtual machine templates:

* *Red Hat Supported* templates are fully supported by Red Hat.
* *User Supported* templates are *Red Hat Supported* templates that were cloned and created by users.
* *Red Hat Provided* templates have limited support from Red Hat.
* *User Provided* templates are *Red Hat Provided* templates that were cloned and created by users.

. Navigate to *Virtualization* -> *Templates* and select *All projects*
+
image::module-04/01_Template_List.png[]

. Press *Create Template* and review auto filled YAML code
+
image::module-04/02_Template_YAML.png[]
+
[NOTE]
This default template is using a container disk to run a VM. The data will be ephemeral.

. Scroll down and check the parameters for the template
+
image::module-04/03_Template_YAML_parameters.png[]

. Press *Create* and review the template details
+
image::module-04/04_Template_details.png[]

. Navigate to *Virtualization* -> *Catalog* and filter by keyword `example`. Select the project `vmexamples`
+
image::module-04/05_Catalog.png[]

. Press *Customize VirtualMachine* and specify the name `fedora03` and the password `r3dh4t1!`. Press *Next*
+
image::module-04/06_Catalog_Create_VM.png[]

. Press *Create VirtualMachine* in the next screen.
+
image::module-04/07_Catalog_Create_VM_Review.png[]

. Navigate to *Console* and login with the password defined before.

. Navigate to tab *Configuration* and subtab *Disks*. Review the VM was created with a container disk as the template defined
+
image::module-04/08_Ephemeral_Disk.png[]

. Using the *Actions* menu, delete the VM.

== Create a Windows virtual machine

In this segment, we will install Microsoft Windows Server 2019 using an ISO hosted on a web server. This represents one way to install an operating system to a virtual machine that takes advantage of the ability to source disks from many locations, including a web server, object storage, or other persistent volumes in the cluster.

This process can be streamlined after the initial operating system installation by creating a template from the virtual machine. The specific process for preparing the guest operating system to be used as a template will vary, be sure to follow your organization's guidelines and requirements when preparing a template OS.

. From the left menu, navigate to *Virtualization* -> *VirtualMachines*:
+
image::module-04/09_Left_Menu.png[]
. It will list the VMs running in the current project.
+
image::module-04/10_List_VMs.png[]
. Press on the top-right the button *Create* and select *From template*
+
image::module-04/11_From_Template.png[]
. Scroll down and select *Microsoft Windows Server 2019 VM* tile.
+
image::module-04/12_Windows_2k9_Tile.png[]

. A dialog will appear showing the default configuration related to the template.
+
image::module-04/13_Windows_2k9_Dialog.png[]

. Press *Customize VirtualMachine* to specify the parameters to be used for the provisioning.
+
image::module-04/14_Windows_2k9_Parameters.png[]

. In this dialog:
.. Specify the name `windows`
.. Enable the checkbox *Boot from CD* and specify the url: http://192.168.123.100:81/Windows2019.iso
. Reduce the CD disk size to *5 GiB*.
. Keep the `Disk source` size disk to the default value *60 GiB*
. Ensure the `Mount Windows drivers disk` is enabled. This is required to install Windows systems, which will provide the drivers for VirtIO.

. Press *Next* after filling in the parameters.
+
image::module-04/15_Windows_2k9_Parameters_Filled.png[]

. Switch to the *Scripts* tab and press *Edit* on the `Sysprep` section
+
image::module-04/16_Windows_2k9_Scripts.png[]

. Fill the `autounattend.xml` form with the following code
+
[source,xml,role=copy]
----
<?xml version="1.0" encoding="utf-8"?>
<unattend xmlns="urn:schemas-microsoft-com:unattend" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:schemas-microsoft-com:unattend">
  <settings pass="windowsPE">
    <component name="Microsoft-Windows-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
      <DiskConfiguration>
        <Disk wcm:action="add">
          <CreatePartitions>
            <CreatePartition wcm:action="add">
              <Order>1</Order>
              <Extend>true</Extend>
              <Type>Primary</Type>
            </CreatePartition>
          </CreatePartitions>
          <ModifyPartitions>
            <ModifyPartition wcm:action="add">
              <Active>true</Active>
              <Format>NTFS</Format>
              <Label>System</Label>
              <Order>1</Order>
              <PartitionID>1</PartitionID>
            </ModifyPartition>
          </ModifyPartitions>
          <DiskID>0</DiskID>
          <WillWipeDisk>true</WillWipeDisk>
        </Disk>
      </DiskConfiguration>
      <ImageInstall>
        <OSImage>
          <InstallFrom>
            <MetaData wcm:action="add">
              <Key>/IMAGE/NAME</Key>
              <Value>Windows Server 2019 SERVERSTANDARD</Value>
            </MetaData>
          </InstallFrom>
          <InstallTo>
            <DiskID>0</DiskID>
            <PartitionID>1</PartitionID>
          </InstallTo>
        </OSImage>
      </ImageInstall>
      <UserData>
        <AcceptEula>true</AcceptEula>
        <FullName>Administrator</FullName>
        <Organization>My Organization</Organization>
      </UserData>
      <EnableFirewall>false</EnableFirewall>
    </component>
    <component name="Microsoft-Windows-International-Core-WinPE" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
      <SetupUILanguage>
        <UILanguage>en-US</UILanguage>
      </SetupUILanguage>
      <InputLocale>en-US</InputLocale>
      <SystemLocale>en-US</SystemLocale>
      <UILanguage>en-US</UILanguage>
      <UserLocale>en-US</UserLocale>
    </component>
  </settings>
  <settings pass="offlineServicing">
    <component name="Microsoft-Windows-LUA-Settings" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
      <EnableLUA>false</EnableLUA>
    </component>
  </settings>
  <settings pass="specialize">
    <component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
      <AutoLogon>
        <Password>
          <Value>R3dh4t1!</Value>
          <PlainText>true</PlainText>
        </Password>
        <Enabled>true</Enabled>
        <LogonCount>999</LogonCount>
        <Username>Administrator</Username>
      </AutoLogon>
      <OOBE>
        <HideEULAPage>true</HideEULAPage>
        <HideLocalAccountScreen>true</HideLocalAccountScreen>
        <HideOnlineAccountScreens>true</HideOnlineAccountScreens>
        <HideWirelessSetupInOOBE>true</HideWirelessSetupInOOBE>
        <NetworkLocation>Work</NetworkLocation>
        <ProtectYourPC>3</ProtectYourPC>
        <SkipMachineOOBE>true</SkipMachineOOBE>
      </OOBE>
      <UserAccounts>
        <LocalAccounts>
          <LocalAccount wcm:action="add">
            <Description>Local Administrator Account</Description>
            <DisplayName>Administrator</DisplayName>
            <Group>Administrators</Group>
            <Name>Administrator</Name>
          </LocalAccount>
        </LocalAccounts>
      </UserAccounts>
      <TimeZone>Eastern Standard Time</TimeZone>
    </component>
  </settings>
  <settings pass="oobeSystem">
    <component name="Microsoft-Windows-International-Core" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
      <InputLocale>en-US</InputLocale>
      <SystemLocale>en-US</SystemLocale>
      <UILanguage>en-US</UILanguage>
      <UserLocale>en-US</UserLocale>
    </component>
    <component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
      <AutoLogon>
        <Password>
          <Value>R3dh4t1!</Value>
          <PlainText>true</PlainText>
        </Password>
        <Enabled>true</Enabled>
        <LogonCount>999</LogonCount>
        <Username>Administrator</Username>
      </AutoLogon>
      <OOBE>
        <HideEULAPage>true</HideEULAPage>
        <HideLocalAccountScreen>true</HideLocalAccountScreen>
        <HideOnlineAccountScreens>true</HideOnlineAccountScreens>
        <HideWirelessSetupInOOBE>true</HideWirelessSetupInOOBE>
        <NetworkLocation>Work</NetworkLocation>
        <ProtectYourPC>3</ProtectYourPC>
        <SkipMachineOOBE>true</SkipMachineOOBE>
      </OOBE>
      <UserAccounts>
        <LocalAccounts>
          <LocalAccount wcm:action="add">
            <Description>Local Administrator Account</Description>
            <DisplayName>Administrator</DisplayName>
            <Group>Administrators</Group>
            <Name>Administrator</Name>
          </LocalAccount>
        </LocalAccounts>
      </UserAccounts>
      <TimeZone>Eastern Standard Time</TimeZone>
    </component>
  </settings>
</unattend>
----

. Click *Save* on the dialog
+
image::module-04/17_Windows_2k9_Sysprep.png[]

. Press *Create VirtualMachine*
+
image::module-04/18_Windows_2k9_Create.png[]

. The Virtual Machine will start the provisioning process by downloading the ISO image, configuring, and starting the instance.
+
image::module-04/19_Windows_2k9_Provisioning.png[]

. After a few minutes, the Virtual VM will be in `Running` status. Switch to the *Console* tab:
+
image::module-04/20_Windows_2k9_Console.png[]
+
[NOTE]
It is not necessary for this workshop to wait for the installation to complete. You can continue to the next module.
+
[IMPORTANT]
The VM is marked as "Not migratable" because a CD-ROM disk is attached. 

== Summary

In this section we learned how to modify an existing template, and how to create one that we could use to easily deploy Windows virtual machines on demand.
